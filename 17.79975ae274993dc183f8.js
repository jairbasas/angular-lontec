(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{TVFa:function(e,t,i){"use strict";i.r(t),i.d(t,"UserProfileModule",function(){return x});var n=i("NdbC"),r=i("iInd"),s=i("36fG"),o=i("Ez0L"),l=i("cp0P"),a=i("mrSG"),c=i("s7LF"),b=i("8Y7J"),m=i("NFMk"),d=i("JXeA"),u=i("DWb9"),f=i("vU8h"),z=i("wf2+"),h=i("fb/r"),p=i("tYkK"),T=i("jTf7"),g=i("SVse"),S=i("GaVp"),U=i("Jp/u"),P=i("WJhm");function E(e,t){if(1&e&&b.Pb(0,"nz-option",13),2&e){const e=t.$implicit;b.mc("nzValue",e.userId)("nzLabel",e.userFullname)}}function A(e,t){if(1&e&&b.Pb(0,"nz-option",13),2&e){const e=t.$implicit;b.mc("nzValue",e.systemId)("nzLabel",e.systemName)}}function y(e,t){if(1&e&&b.Pb(0,"nz-option",13),2&e){const e=t.$implicit;b.mc("nzValue",e.profileId)("nzLabel",e.profileName)}}function I(e,t){if(1&e){const e=b.Vb();b.Ub(0,"div"),b.Ub(1,"button",14),b.bc("click",function(){return b.vc(e),b.ec().onCancel()}),b.Hc(2,"Cancelar"),b.Tb(),b.Ub(3,"button",15),b.bc("click",function(){return b.vc(e),b.ec().onSubmit()}),b.Hc(4,"Guardar"),b.Tb(),b.Tb()}if(2&e){const e=b.ec();b.Ab(3),b.mc("nzLoading",e.loadingSubmit)}}let v=(()=>{class e{constructor(e,t,i,n,r){this.fb=e,this.modalRef=t,this.messageService=i,this.securityService=n,this.modalMessage=r,this.state=s.a.STATE_ENTITY.ENABLE,this.loadingSubmit=!1,this.loadingSping=!1,this.userList=[],this.systemList=[],this.profileList=[]}ngOnInit(){this.initForm(),this.initList()}initForm(){this.frmUserProfileEdit=this.fb.group({ddluser:[null,[c.q.required]],ddlsystem:[null,[c.q.required]],ddlprofile:[null,[c.q.required]]})}initList(){Object(l.a)([this.securityService.getSystemSearch({state:s.a.STATE_ENTITY.ENABLE}),this.securityService.getUserSearch({state:s.a.STATE_ENTITY.ENABLE})]).subscribe(e=>{this.systemList=e[0],this.userList=e[1]},e=>{this.messageService.error(s.a.MESSAGE.ERROR_GET_DATA)},()=>{this.userList.map(e=>e.userFullname=e.userName+" "+e.fatherLastName+" "+e.motherLastName),void 0!==this.userProfileId&&this.onSearch()})}onChangeddlsystem(e){this.profileList=[],this.frmUserProfileEdit.get("ddlprofile").setValue(null),null!=e&&this.securityService.getProfileSearch({systemId:e,state:s.a.STATE_ENTITY.ENABLE}).subscribe(e=>{this.profileList=e})}onSearch(){this.loadingSping=!0,this.securityService.getUserProfileById(this.userProfileId).subscribe(e=>{this.loadingSping=!1,this.frmUserProfileEdit.get("ddluser").setValue(e.userId),this.state=e.state,this.onSearchProfile(e.profileId)},e=>{this.loadingSping=!1,this.messageService.error(s.a.MESSAGE.ERROR_GET_DATA)})}onSearchProfile(e){this.securityService.getProfileById(e).subscribe(e=>{this.frmUserProfileEdit.get("ddlsystem").setValue(e.systemId),this.frmUserProfileEdit.get("ddlprofile").setValue(e.profileId)})}validateExistence(){return Object(a.a)(this,void 0,void 0,function*(){let e=0,t=!1;return void 0!==this.userProfileId&&(e=this.userProfileId),yield this.securityService.getUserProfileSearch({userId:Number(this.frmUserProfileEdit.value.ddluser),profileId:Number(this.frmUserProfileEdit.value.ddlprofile)}).toPromise().then(i=>{i.length>0&&Number(i[0].userProfileId)!==e&&(this.messageService.warning("El usuario, ya esta registrado con el perfil seleccionado"),t=!0)}),t||(yield this.securityService.getUserProfileSearch({userId:Number(this.frmUserProfileEdit.value.ddluser)}).toPromise().then(e=>{e.length>0&&Number(e[0].profileId)!==Number(this.frmUserProfileEdit.value.ddlprofile)&&(this.messageService.warning("El usuario, ya tiene asignado un perfil para este Sistema"),t=!0)})),t})}setCommand(){return{userProfileId:this.userProfileId,state:this.state,userId:this.frmUserProfileEdit.value.ddluser,profileId:this.frmUserProfileEdit.value.ddlprofile,registerUserId:Object(o.d)(),registerUserFullname:Object(o.c)()}}onCancel(){this.modalRef.destroy()}onSubmit(){return Object(a.a)(this,void 0,void 0,function*(){if(Object(o.j)(this.frmUserProfileEdit)){if(yield this.validateExistence())return;this.modalMessage.confirm(s.a.MESSAGE.CONFIRM_QUESTION,()=>{this.loadingSubmit=!0,this.securityService.postUserProfile(this.setCommand()).subscribe(e=>{this.loadingSubmit=!1,this.messageService.success(s.a.MESSAGE.SUCCESS_SAVE),this.modalRef.destroy({confirmProcess:!0})},e=>{this.loadingSubmit=!1,this.messageService.error(s.a.MESSAGE.ERROR)})})}else this.messageService.warning(s.a.MESSAGE.COMPLETE_FORM)})}}return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(m.c),b.Ob(d.e),b.Ob(u.a),b.Ob(f.a))},e.\u0275cmp=b.Ib({type:e,selectors:[["app-user-profile-edit"]],inputs:{userProfileId:"userProfileId"},decls:27,vars:11,consts:[["nz-form","","nzLayout","vertical",3,"formGroup"],[3,"nzSpinning"],["nz-row",""],["nz-col","",3,"nzSm","nzXs"],["nzRequired","","nzFor","user"],["nzErrorTip","Campo obligatorio."],["nzShowSearch","","formControlName","ddluser","nzPlaceHolder","Usuario"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzRequired","","nzFor","system"],["nzShowSearch","","formControlName","ddlsystem","nzPlaceHolder","Sistema",3,"ngModelChange"],["nzRequired","","nzFor","profile"],["nzShowSearch","","formControlName","ddlprofile","nzPlaceHolder","Perfil"],[4,"nzModalFooter"],[3,"nzValue","nzLabel"],["nz-button","","nzType","primary","nzDanger","",3,"click"],["nz-button","","nzType","primary",3,"nzLoading","click"]],template:function(e,t){1&e&&(b.Ub(0,"form",0),b.Ub(1,"nz-spin",1),b.Ub(2,"div",2),b.Ub(3,"div",3),b.Ub(4,"nz-form-item"),b.Ub(5,"nz-form-label",4),b.Hc(6,"Usuario"),b.Tb(),b.Ub(7,"nz-form-control",5),b.Ub(8,"nz-select",6),b.Fc(9,E,1,2,"nz-option",7),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(10,"div",2),b.Ub(11,"div",3),b.Ub(12,"nz-form-item"),b.Ub(13,"nz-form-label",8),b.Hc(14,"Sistema"),b.Tb(),b.Ub(15,"nz-form-control",5),b.Ub(16,"nz-select",9),b.bc("ngModelChange",function(e){return t.onChangeddlsystem(e)}),b.Fc(17,A,1,2,"nz-option",7),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(18,"div",2),b.Ub(19,"div",3),b.Ub(20,"nz-form-item"),b.Ub(21,"nz-form-label",10),b.Hc(22,"Perfil"),b.Tb(),b.Ub(23,"nz-form-control",5),b.Ub(24,"nz-select",11),b.Fc(25,y,1,2,"nz-option",7),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Fc(26,I,5,1,"div",12)),2&e&&(b.mc("formGroup",t.frmUserProfileEdit),b.Ab(1),b.mc("nzSpinning",t.loadingSping),b.Ab(2),b.mc("nzSm",24)("nzXs",24),b.Ab(6),b.mc("ngForOf",t.userList),b.Ab(2),b.mc("nzSm",24)("nzXs",24),b.Ab(6),b.mc("ngForOf",t.systemList),b.Ab(2),b.mc("nzSm",24)("nzXs",24),b.Ab(6),b.mc("ngForOf",t.profileList))},directives:[c.r,c.n,z.b,c.i,h.a,p.c,p.a,z.c,z.d,z.a,T.d,c.m,c.h,g.m,m.a,T.a,S.a,U.a,P.a],styles:[""]}),e})();var L=i("YdS3"),N=i("px0D"),C=i("66zS"),F=i("haRT"),O=i("W4B1");function R(e,t){if(1&e&&b.Pb(0,"nz-option",24),2&e){const e=t.$implicit;b.mc("nzValue",e.systemId)("nzLabel",e.systemName)}}function M(e,t){if(1&e&&b.Pb(0,"nz-option",24),2&e){const e=t.$implicit;b.mc("nzValue",e.profileId)("nzLabel",e.profileName)}}function _(e,t){if(1&e&&b.Pb(0,"nz-option",24),2&e){const e=t.$implicit;b.mc("nzValue",e.parameterDetailId)("nzLabel",e.fieldValue1)}}function w(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",30),b.bc("click",function(){b.vc(e);const t=b.ec().$implicit;return b.ec().onChangeState(t.userProfileId,t.state)}),b.Pb(1,"i",31),b.Tb()}}function G(e,t){if(1&e){const e=b.Vb();b.Ub(0,"button",32),b.bc("click",function(){b.vc(e);const t=b.ec().$implicit;return b.ec().onChangeState(t.userProfileId,t.state)}),b.Pb(1,"i",33),b.Tb()}}function H(e,t){if(1&e){const e=b.Vb();b.Ub(0,"tr"),b.Ub(1,"td",25),b.Hc(2),b.Tb(),b.Ub(3,"td",25),b.Hc(4),b.Tb(),b.Ub(5,"td",25),b.Hc(6),b.Tb(),b.Ub(7,"td",25),b.Hc(8),b.Tb(),b.Ub(9,"td",25),b.Ub(10,"button",26),b.bc("click",function(){b.vc(e);const i=t.$implicit;return b.ec().onOpenUserProfileEditModal(i.userProfileId)}),b.Pb(11,"i",27),b.Tb(),b.Tb(),b.Ub(12,"td",25),b.Fc(13,w,2,0,"button",28),b.Tb(),b.Ub(14,"td",25),b.Fc(15,G,2,0,"button",29),b.Tb(),b.Tb()}if(2&e){const e=t.$implicit,i=b.ec();b.Ab(2),b.Lc("",e.userName," ",e.fatherLastName," ",e.motherLastName,""),b.Ab(2),b.Ic(e.systemName),b.Ab(2),b.Ic(e.profileName),b.Ab(2),b.Ic(e.stateName),b.Ab(5),b.mc("ngIf",e.state!==i.state),b.Ab(2),b.mc("ngIf",e.state===i.state)}}const k=[{path:"",component:(()=>{class e{constructor(e,t,i,n){this.fb=e,this.modalMessage=t,this.securityService=i,this.modalService=n,this.stateList=[],this.systemList=[],this.profileList=[],this.pageIndex=s.a.PAGINATION.PAGE_INDEX,this.pageSize=s.a.PAGINATION.PAGE_SIZE,this.sortProperty="",this.sortPropertyName="",this.totalRecord=0,this.state=s.a.STATE_ENTITY.ENABLE,this.tableUserProfileLoading=!1,this.tableUserProfile=[]}ngOnInit(){this.initForm(),this.initList()}initForm(){this.frmUserProfile=this.fb.group({username:[null],ddlsystem:[null],ddlprofile:[null],ddlstate:[null]})}initList(){Object(l.a)([this.securityService.getParameterDetailSearch({parameterId:s.a.PARAMETERS.ENTITY_STATE}),this.securityService.getSystemSearch({state:s.a.STATE_ENTITY.ENABLE})]).subscribe(e=>{this.stateList=e[0],this.systemList=e[1]},e=>{this.modalMessage.error(s.a.MESSAGE.ERROR_GET_DATA)},()=>{this.onSearch()})}onSearch(){let e=null===this.frmUserProfile.value.username?"":this.frmUserProfile.value.username,t=null===this.frmUserProfile.value.ddlsystem?0:this.frmUserProfile.value.ddlsystem,i=null===this.frmUserProfile.value.ddlprofile?0:this.frmUserProfile.value.ddlprofile,n=null===this.frmUserProfile.controls.ddlstate.value?0:this.frmUserProfile.controls.ddlstate.value;this.tableUserProfileLoading=!0,this.securityService.getUserProfileFindAll({userName:e,systemId:t,profileId:i,state:n,PageIndex:this.pageIndex,PageSize:this.pageSize,sort:this.sortProperty}).subscribe(e=>{this.tableUserProfile=e.items,this.totalRecord=e.pagination.total,this.tableUserProfileLoading=!1},e=>{this.tableUserProfileLoading=!1,this.modalMessage.error(s.a.MESSAGE.ERROR_GET_DATA)})}onQueryParamsChange(e){const{pageSize:t,pageIndex:i,sort:n}=e;let r;this.pageIndex=i,this.pageSize=t,null!==n[0].value&&("ascend"==n[0].value&&(r="ASC"),"descend"==n[0].value&&(r="DESC"),"name"===n[0].key&&(this.sortProperty="user_name "+r)),this.onSearch()}onChangeddlsystem(e){this.profileList=[],this.frmUserProfile.get("ddlprofile").setValue(null),null!==e&&this.securityService.getProfileSearch({systemId:e,state:s.a.STATE_ENTITY.ENABLE}).subscribe(e=>this.profileList=e)}onOpenUserProfileEditModal(e){this.modalService.create({nzTitle:s.a.MODAL_TITLE.REGISTER_USER_PROFILE,nzClosable:!1,nzContent:v,nzComponentParams:{userProfileId:e}}).afterClose.subscribe(e=>{void 0!==e&&this.onSearch()})}setCommand(e,t){return{userProfileId:e,state:this.state===t?s.a.STATE_ENTITY.DISABLE:s.a.STATE_ENTITY.ENABLE,updateUserId:Object(o.d)(),updateUserFullname:Object(o.c)()}}onChangeState(e,t){this.modalMessage.confirm(s.a.MESSAGE.CONFIRM_QUESTION,()=>{this.tableUserProfileLoading=!0,this.securityService.putUserProfileChangeState(this.setCommand(e,t)).subscribe(()=>{this.onSearch()},e=>{this.tableUserProfileLoading=!1,this.modalMessage.error(s.a.MESSAGE.ERROR)})})}}return e.\u0275fac=function(t){return new(t||e)(b.Ob(c.e),b.Ob(f.a),b.Ob(u.a),b.Ob(m.d))},e.\u0275cmp=b.Ib({type:e,selectors:[["app-user-profile"]],decls:57,vars:32,consts:[["nz-form","","nzLayout","vertical",3,"formGroup"],["nzTitle","Usuarios Perfiles"],["nz-row",""],["nz-col","",3,"nzSm","nzXs"],["nzFor","username"],["nz-input","","formControlName","username","placeholder","Usuario"],["nzFor","system"],["nzShowSearch","","nzAllowClear","","formControlName","ddlsystem","nzPlaceHolder","Sistema",3,"ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzFor","profile"],["nzShowSearch","","nzAllowClear","","formControlName","ddlprofile","nzPlaceHolder","Pefil"],["nzFor","ddlstate"],["nzShowSearch","","nzAllowClear","","formControlName","ddlstate","nzPlaceHolder","Estados"],[1,"text-right"],["nz-button","","nzType","primary",2,"margin-left","5px","margin-right","5px",3,"click"],["nz-icon","","nzType","plus"],["nz-button","","nzType","default",2,"margin-left","5px","margin-right","9px",3,"click"],["nz-icon","","nzType","search"],["nz-row","",1,"ant-form-item","mt-15"],["nzSize","small","nzShowSizeChanger","",3,"nzFrontPagination","nzLoading","nzData","nzTotal","nzPageIndex","nzPageSize","nzPageIndexChange","nzPageSizeChange","nzQueryParams"],["nzColumnKey","name",1,"tr-color",3,"nzAlign","nzSortFn"],[1,"tr-color",3,"nzAlign"],[1,"tr-color",3,"nzAlign","nzWidth"],[4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],["nzAlign","center"],["nz-button","","nzType","primary","nzTooltipTitle","Editar","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click"],["nz-icon","","nzType","edit","nzTheme","outline"],["nz-button","","nzTooltipTitle","Habilitar","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click",4,"ngIf"],["nz-button","","nzDanger","","nzTooltipTitle","Deshabilitar","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click",4,"ngIf"],["nz-button","","nzTooltipTitle","Habilitar","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click"],["nz-icon","","nzType","like","nzTheme","outline"],["nz-button","","nzDanger","","nzTooltipTitle","Deshabilitar","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click"],["nz-icon","","nzType","dislike","nzTheme","outline"]],template:function(e,t){1&e&&(b.Ub(0,"form",0),b.Ub(1,"nz-card",1),b.Ub(2,"div",2),b.Ub(3,"div",3),b.Ub(4,"nz-form-item"),b.Ub(5,"nz-form-label",4),b.Hc(6,"Usuario"),b.Tb(),b.Ub(7,"nz-form-control"),b.Pb(8,"input",5),b.Tb(),b.Tb(),b.Tb(),b.Ub(9,"div",3),b.Ub(10,"nz-form-item"),b.Ub(11,"nz-form-label",6),b.Hc(12,"Sistema"),b.Tb(),b.Ub(13,"nz-form-control"),b.Ub(14,"nz-select",7),b.bc("ngModelChange",function(e){return t.onChangeddlsystem(e)}),b.Fc(15,R,1,2,"nz-option",8),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(16,"div",3),b.Ub(17,"nz-form-item"),b.Ub(18,"nz-form-label",9),b.Hc(19,"Perfil"),b.Tb(),b.Ub(20,"nz-form-control"),b.Ub(21,"nz-select",10),b.Fc(22,M,1,2,"nz-option",8),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(23,"div",2),b.Ub(24,"div",3),b.Ub(25,"nz-form-item"),b.Ub(26,"nz-form-label",11),b.Hc(27,"Estado"),b.Tb(),b.Ub(28,"nz-form-control"),b.Ub(29,"nz-select",12),b.Fc(30,_,1,2,"nz-option",8),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(31,"div",2),b.Ub(32,"div",3),b.Ub(33,"div",13),b.Ub(34,"button",14),b.bc("click",function(){return t.onOpenUserProfileEditModal()}),b.Pb(35,"i",15),b.Hc(36," Nuevo"),b.Tb(),b.Ub(37,"button",16),b.bc("click",function(){return t.onSearch()}),b.Pb(38,"i",17),b.Hc(39,"Buscar"),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Ub(40,"div",18),b.Ub(41,"nz-table",19),b.bc("nzPageIndexChange",function(e){return t.pageIndex=e})("nzPageSizeChange",function(e){return t.pageSize=e})("nzQueryParams",function(e){return t.onQueryParamsChange(e)}),b.Ub(42,"thead"),b.Ub(43,"tr"),b.Ub(44,"th",20),b.Hc(45,"Nombre Usuario"),b.Tb(),b.Ub(46,"th",21),b.Hc(47,"Sistema"),b.Tb(),b.Ub(48,"th",21),b.Hc(49,"Perfil"),b.Tb(),b.Ub(50,"th",21),b.Hc(51,"Estado"),b.Tb(),b.Pb(52,"th",22),b.Pb(53,"th",22),b.Pb(54,"th",22),b.Tb(),b.Tb(),b.Ub(55,"tbody"),b.Fc(56,H,16,8,"tr",23),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb()),2&e&&(b.mc("formGroup",t.frmUserProfile),b.Ab(3),b.mc("nzSm",8)("nzXs",24),b.Ab(6),b.mc("nzSm",8)("nzXs",24),b.Ab(6),b.mc("ngForOf",t.systemList),b.Ab(1),b.mc("nzSm",8)("nzXs",24),b.Ab(6),b.mc("ngForOf",t.profileList),b.Ab(2),b.mc("nzSm",8)("nzXs",24),b.Ab(6),b.mc("ngForOf",t.stateList),b.Ab(2),b.mc("nzSm",24)("nzXs",24),b.Ab(9),b.mc("nzFrontPagination",!1)("nzLoading",t.tableUserProfileLoading)("nzData",t.tableUserProfile)("nzTotal",t.totalRecord)("nzPageIndex",t.pageIndex)("nzPageSize",t.pageSize),b.Ab(3),b.mc("nzAlign","center")("nzSortFn",!0),b.Ab(2),b.mc("nzAlign","center"),b.Ab(2),b.mc("nzAlign","center"),b.Ab(2),b.mc("nzAlign","center"),b.Ab(2),b.mc("nzAlign","center")("nzWidth","20px"),b.Ab(1),b.mc("nzAlign","center")("nzWidth","20px"),b.Ab(1),b.mc("nzAlign","center")("nzWidth","20px"),b.Ab(2),b.mc("ngForOf",t.tableUserProfile))},directives:[c.r,c.n,z.b,c.i,L.a,p.c,p.a,z.c,z.d,z.a,N.b,c.d,c.m,c.h,T.d,g.m,S.a,U.a,P.a,C.a,F.c,F.j,F.k,F.b,F.i,F.h,F.a,F.f,T.a,O.d,g.n],styles:[""]}),e})()}];let V=(()=>{class e{}return e.\u0275mod=b.Mb({type:e}),e.\u0275inj=b.Lb({factory:function(t){return new(t||e)},imports:[[r.g.forChild(k)],r.g]}),e})(),x=(()=>{class e{}return e.\u0275mod=b.Mb({type:e}),e.\u0275inj=b.Lb({factory:function(t){return new(t||e)},imports:[[n.a,V]]}),e})()}}]);